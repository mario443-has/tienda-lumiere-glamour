{% load static %}
<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{% block title %}Lumière Glamour{% endblock %}</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts: Great Vibes para el logo, Inter para el texto general -->
    <link
      href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Inter:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <!-- Font Awesome para íconos -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
    />
    <!-- Estilos personalizados para categorías -->
    <link rel="stylesheet" href="{% static 'css/categorias.css' %}">
    {# Este bloque es para CSS o meta tags adicionales específicos de una página #}
    {% block extra_head %}{% endblock %}

    <!-- Enlace a tu archivo CSS principal externo -->
    <link rel="stylesheet" href="{% static 'css/main.css' %}">

    <!-- Google tag (gtag.js) -->
    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=G-RPSFD64V89"
    ></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());

      gtag("config", "G-RPSFD64V89");
    </script>
  </head>

  <body class="bg-gray-100 font-inter text-gray-800">
    <!-- Header Section - Barra de Navegación Unificada -->
    <header class="bg-white shadow-md sticky top-0 z-50">
      <!-- Barra Superior de Información -->
      <div
        class="bg-gradient-to-r from-pink-500 to-purple-600 text-white text-center text-sm py-2 px-4"
      >
        <span>Envíos a toda Colombia 100% seguros y garantizados</span>
      </div>

      <div
        class="container mx-auto px-4 py-3 flex justify-between items-center"
      >
        <!-- Logo de la tienda -->
        <a href="{% url 'home' %}" class="flex items-center space-x-2">
          <img
            src="{% static 'img/logo.png' %}"
            alt="Lumière Glamour Logo"
            class="h-16 sm:h-20 w-auto rounded-full shadow-md" {# Ajuste de tamaño para móvil #}
          />
          <span
            class="text-3xl font-great-vibes text-pink-600 hover:text-pink-700 transition duration-300"
          >
            Lumiere Glamour
          </span>
        </a>

        <!-- Barra de Búsqueda (Desktop) -->
        <form
          action="{% url 'home' %}"
          method="get"
          class="hidden md:flex items-center flex-grow max-w-md mx-4"
        >
          <input
            type="text"
            name="q"
            placeholder="Buscar productos..."
            class="w-full px-4 py-2 border border-gray-300 rounded-l-md focus:outline-none focus:ring-2 focus:ring-pink-500"
            value="{{ request.GET.q|default:'' }}"
          />
          <button
            type="submit"
            class="bg-pink-600 text-white px-4 py-2 rounded-r-md hover:bg-pink-700 transition duration-300"
          >
            <i class="fas fa-search"></i>
          </button>
        </form>

        <!-- Iconos de Usuario y Carrito (Desktop) -->
        <div class="hidden md:flex items-center space-x-4">
          <!-- Ícono de usuario comentado temporalmente -->
          <!-- <a href="#" class="text-gray-700 hover:text-pink-600 transition duration-300" title="Mi Cuenta">
                    <i class="fas fa-user text-xl"></i>
                </a> -->
          <a
            href="#"
            class="relative text-gray-700 hover:text-pink-600 transition duration-300"
            title="Mi Carrito"
            onclick="openCartModal(); return false;" {# MODIFICADO: Abre el modal y evita la navegación #}
          >
            <i class="fas fa-shopping-bag text-xl"></i>
            <span
              id="cart-count"
              class="absolute -top-2 -right-2 bg-pink-600 text-white text-xs font-bold rounded-full h-5 w-5 flex items-center justify-center hidden"
              >0</span
            >
          </a>
        </div>

        <!-- Botones de Menú Móvil (Hamburger y Carrito) -->
        <div class="md:hidden flex items-center space-x-4"> {# Añadido contenedor para los botones móviles #}
            <a
                href="#"
                class="relative text-gray-700 hover:text-pink-600 transition duration-300"
                title="Mi Carrito"
                onclick="openCartModal(); return false;" {# Abre el modal y evita la navegación #}
            >
                <i class="fas fa-shopping-bag text-xl"></i>
                <span
                    id="mobile-cart-count"
                    class="absolute -top-2 -right-2 bg-pink-600 text-white text-xs font-bold rounded-full h-5 w-5 flex items-center justify-center hidden"
                >0</span>
            </a>
            <button
                id="mobile-menu-button"
                class="text-gray-700 hover:text-pink-600 focus:outline-none"
            >
                <svg
                    class="w-6 h-6"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                    xmlns="http://www.w3.org/2000/svg"
                >
                    <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M4 6h16M4 12h16M4 18h16"
                    ></path>
                </svg>
            </button>
        </div>
      </div>

      <!-- Menú de Navegación Principal (Desktop) -->
      <nav class="hidden md:flex justify-center py-2 bg-gray-50 shadow-inner">
        <ul class="flex space-x-8">
          <li>
            <a
              href="{% url 'home' %}"
              class="text-gray-700 hover:text-pink-600 font-medium transition duration-300"
              >Inicio</a
            >
          </li>

          <li class="relative group">
            <button
              class="flex items-center text-gray-700 hover:text-pink-600 font-medium transition duration-300 focus:outline-none"
            >
              Categorías
              <svg
                class="ml-1 w-4 h-4"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M19 9l-7 7-7-7"
                ></path>
              </svg>
            </button>
            <div
              class="absolute left-0 mt-2 w-64 bg-white rounded-md shadow-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-300 transform scale-95 group-hover:scale-100 origin-top"
            >
              <div class="py-1">
                {# Iterar sobre categorías principales para la nueva estructura jerárquica #}
                {% for categoria_principal in categorias_principales %}
                  <div class="relative group/sub">
                    <a
                      href="{% url 'categoria' categoria_principal.slug %}" {# Apunta a la categoría principal #}
                      class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 hover:text-pink-600 flex justify-between items-center"
                    >
                      {{ categoria_principal.nombre }}
                      {% if categoria_principal.subcategorias.all %} {# Comprueba si tiene subcategorías #}
                      <svg
                        class="w-4 h-4 transform rotate-90 group-hover/sub:rotate-0 transition-transform duration-200"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          stroke-width="2"
                          d="M9 5l7 7-7 7"
                        ></path>
                      </svg>
                      {% endif %}
                    </a>
                    {% if categoria_principal.subcategorias.all %} {# Si tiene subcategorías, crea el submenú #}
                    <div
                      class="absolute left-full top-0 ml-1 w-48 bg-white rounded-md shadow-lg opacity-0 invisible group-hover/sub:opacity-100 group-hover/sub:visible transition-all duration-300 transform scale-95 group-hover/sub:scale-100 origin-top-left"
                    >
                      {# Iterar sobre las subcategorías de la categoría principal #}
                      {% for subcategoria in categoria_principal.subcategorias.all %}
                      <a
                        href="{% url 'categoria' subcategoria.slug %}" {# Apunta a la subcategoría #}
                        class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 hover:text-pink-600"
                      >
                        {{ subcategoria.nombre }}
                      </a>
                      {% endfor %}
                    </div>
                    {% endif %}
                  </div>
                {% empty %}
                  <a href="#" class="block px-4 py-2 text-sm text-gray-500">No hay categorías disponibles.</a>
                {% endfor %}
              </div>
            </div>
          </li>
          <!-- Elementos de menú configurables desde el admin (MenuItem) -->
          {% if menu_items %} {% for item in menu_items %}
          <li>
            <a
              href="{{ item.url }}"
              class="text-gray-700 hover:text-pink-600 font-medium transition duration-300"
              >{{ item.nombre }}</a
            >
          </li>
          {% endfor %} {% else %}
          <!-- Ejemplos de enlaces si no se configuran desde el admin -->
          <li>
            <a
              href="{% url 'home' %}"
              class="text-gray-700 hover:text-pink-600 font-medium transition duration-300"
              >Ofertas</a
            >
          </li>
          <li>
            <a
              href="#"
              class="text-gray-700 hover:text-pink-600 font-medium transition duration-300"
              >Contacto</a
            >
          </li>
          <li>
            <a
              href="#"
              class="text-gray-700 hover:text-pink-600 font-medium transition duration-300"
              >Cibermake</a
            >
          </li>
          <li>
            <a
              href="#"
              class="text-gray-700 hover:text-pink-600 font-medium transition duration-300"
              >Blog</a
            >
          </li>
          {% endif %}
        </ul>
      </nav>

      <!-- Menú Móvil (Oculto por defecto) -->
      <div id="mobile-menu" class="hidden md:hidden bg-white shadow-lg pb-4">
        <!-- Barra de Búsqueda (Móvil) -->
        <form action="{% url 'home' %}" method="get" class="px-4 py-2">
          <div class="flex">
            <input
              type="text"
              name="q"
              placeholder="Buscar productos..."
              class="w-full px-4 py-2 border border-gray-300 rounded-l-md focus:outline-none focus:ring-2 focus:ring-pink-500"
              value="{{ request.GET.q|default:'' }}"
            />
            <button
              type="submit"
              class="bg-pink-600 text-white px-4 py-2 rounded-r-md hover:bg-pink-700 transition duration-300"
            >
              <i class="fas fa-search"></i>
            </button>
          </div>
        </form>

        <a
          href="{% url 'home' %}"
          class="block px-4 py-2 text-gray-700 hover:bg-gray-100 hover:text-pink-600"
          >Inicio</a
        >

        <!-- Categorías Desplegables Móviles -->
        <div class="relative">
          <button
            id="mobile-categories-button"
            class="w-full text-left px-4 py-2 text-gray-700 hover:bg-gray-100 hover:text-pink-600 flex justify-between items-center"
            onclick="toggleSubmenu(this)"
          >
            Categorías
            <svg
              class="ml-1 w-4 h-4 transform rotate-0 transition-transform duration-200"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M19 9l-7 7-7-7"
              ></path>
            </svg>
          </button>
          <div
            id="mobile-categories-dropdown"
            class="hidden pl-8 py-1 bg-gray-50"
          >
            {# Bucle para Categorías en Móvil con jerarquía #}
            {% for categoria_principal in categorias_principales %}
            <div class="relative">
              <button
                class="w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 hover:text-pink-600 flex justify-between items-center"
                onclick="toggleSubmenu(this)"
              >
                <a href="{% url 'categoria' categoria_principal.slug %}" class="flex-grow">{{ categoria_principal.nombre }}</a> {# Enlace directo para la categoría principal #}
                {% if categoria_principal.subcategorias.all %}
                <svg
                  class="w-4 h-4 transform rotate-90 transition-transform duration-200"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M9 5l7 7-7 7"
                  ></path>
                </svg>
                {% endif %}
              </button>
              {% if categoria_principal.subcategorias.all %}
              <div class="hidden pl-4 py-1 bg-gray-100">
                {% for subcategoria in categoria_principal.subcategorias.all %}
                <a
                  href="{% url 'categoria' subcategoria.slug %}" {# Apunta a la subcategoría #}
                  class="block px-4 py-2 text-xs text-gray-700 hover:bg-gray-200 hover:text-pink-600"
                  >{{ subcategoria.nombre }}</a
                >
                {% endfor %}
              </div>
              {% endif %}
            </div>
            {% empty %}
            <a href="#" class="block px-4 py-2 text-sm text-gray-500"
              >No hay categorías disponibles.</a
            >
            {% endfor %}
          </div>
        </div>
        <!-- Elementos de menú configurables para móvil -->
        {% if menu_items %} {% for item in menu_items %}
        <a
          href="{{ item.url }}"
          class="block px-4 py-2 text-gray-700 hover:bg-gray-100 hover:text-pink-600"
          >{{ item.nombre }}</a
        >
        {% endfor %} {% else %}
        <a
          href="{% url 'home' %}"
          class="block px-4 py-2 text-gray-700 hover:bg-gray-100 hover:text-pink-600"
          >Ofertas</a
        >
        <a
          href="#"
          class="block px-4 py-2 text-gray-700 hover:bg-gray-100 hover:text-pink-600"
          >Contacto</a
        >
        <a
          href="#"
          class="block px-4 py-2 text-gray-700 hover:bg-gray-100 hover:text-pink-600"
          >Cibermake</a
        >
        <a
          href="#"
          class="block px-4 py-2 text-gray-700 hover:bg-gray-100 hover:text-pink-600"
          >Blog</a
        >
        {% endif %}
        <!-- Iconos de Usuario y Carrito (Móvil) - ELIMINADO DE AQUÍ -->
      </div>
    </header>

    {# Contenido dinámico de cada página #}
    {% block content %}
    {% endblock %}

    <!-- Footer Section -->
    <footer class="bg-gray-800 text-white py-8 mt-8">
      <div class="container mx-auto px-4 grid grid-cols-1 md:grid-cols-3 gap-8">
        <div class="footer-col text-center md:text-left">
          <h4 class="text-xl font-semibold mb-4">Lumiere Glamour</h4>
          <p class="text-gray-300">
            Tienda de maquillaje profesional, cuidado facial y accesorios.
          </p>
          <p class="text-gray-300 mt-2">
            <strong>Ipiales - Nariño - Colombia</strong>
          </p>
        </div>
        <div class="footer-col text-center md:text-left">
          <h4 class="text-xl font-semibold mb-4">Enlaces Rápidos</h4>
          <ul>
            <li class="mb-2">
              <a
                href="#"
                class="text-gray-300 hover:text-pink-500 transition duration-300"
                >Brochas</a

              >
            </li>
            <li class="mb-2">
              <a
                href="#"
                class="text-gray-300 hover:text-pink-500 transition duration-300"
                >Bases</a
              >
            </li>
            <li class="mb-2">
              <a
                href="#"
                class="text-gray-300 hover:text-pink-500 transition duration-300"
                >Cuidado Facial</a
              >
            </li>
            <li class="mb-2">
              <a
                href="#"
                class="text-gray-300 hover:text-pink-500 transition duration-300"
                >Descuentos</a
              >
            </li>
          </ul>
        </div>
        <div class="footer-col text-center md:text-left">
          <h4 class="text-xl font-semibold mb-4">Contáctanos</h4>
          <div class="space-y-2">
            <a
              href="https://wa.me/573007221200"
              target="_blank"
              class="text-gray-300 hover:text-pink-500 transition duration-300 flex items-center justify-center md:justify-start"
              title="Enviar mensaje por WhatsApp"
            >
              <i class="fab fa-whatsapp mr-2"></i> WhatsApp
            </a>

            <a
              href="https://www.instagram.com/lumiere_glamour_"
              target="_blank"
              class="text-gray-300 hover:text-pink-500 transition duration-300 flex items-center justify-center md:justify-start"
              title="Visitar Instagram"
            >
              <i class="fab fa-instagram mr-2"></i> Instagram
            </a>

            <a
              href="https://www.facebook.com/share/16uFunJpCr/?mibextid=wwXIfr"
              target="_blank"
              class="text-gray-300 hover:text-pink-500 transition duration-300 flex items-center justify-center md:justify-start"
              title="Ir a nuestra página de Facebook"
            >
              <i class="fab fa-facebook mr-2"></i> Facebook
            </a>

            <a
              href="https://www.tiktok.com/@lumiere.glamour3"
              target="_blank"
              class="text-gray-300 hover:text-pink-500 transition duration-300 flex items-center justify-center md:justify-start"
              title="Ver en TikTok"
            >
              <i class="fab fa-tiktok mr-2"></i> TikTok
            </a>
          </div>
        </div>
      </div>
      <p class="copyright text-center text-gray-400 text-sm mt-8">
        © {{ "now"|date:"Y" }} Lumiere Glamour. Todos los derechos reservados.
      </p>
    </footer>

    <!-- BOTÓN FLOTANTE WHATSAPP (General) -->
    <a
      href="https://wa.me/{{ whatsapp_number|default:'573007221200' }}?text=Hola%2C%20tengo%20una%20consulta%20general."
      class="whatsapp-flotante fixed bottom-6 right-6 bg-green-500 text-white p-4 rounded-full shadow-lg hover:bg-green-600 transition duration-300 z-40"
      target="_blank"
      title="Escríbenos por WhatsApp (Consulta General)"
    >
      <i class="fab fa-whatsapp text-2xl"></i>
    </a>

    <!-- NUEVO BOTÓN FLOTANTE "Comprar por WhatsApp" (para el carrito) -->
    <button
      id="buy-whatsapp-button"
      class="fixed bottom-20 right-6 bg-purple-600 text-white py-3 px-4 rounded-full shadow-lg hover:bg-purple-700 transition duration-300 z-40 flex items-center space-x-2 hidden"
    >
      <i class="fab fa-whatsapp text-xl"></i>
      <span>Comprar Carrito</span>
      <span
        id="buy-whatsapp-cart-count"
        class="bg-white text-purple-600 text-xs font-bold rounded-full h-5 w-5 flex items-center justify-center"
        >0</span
      >
    </button>

    <!-- MODAL DEL CARRITO -->
    <div
      id="cart-modal"
      class="fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center z-50 hidden"
    >
      <div
        class="bg-white rounded-lg shadow-xl p-6 w-11/12 max-w-md mx-auto transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full"
      >
        <!-- Encabezado del Modal -->
        <div
          class="flex justify-between items-center pb-3 border-b border-gray-200"
        >
          <h3 class="text-2xl font-semibold text-gray-900">Tu Carrito</h3>
          <button
            type="button"
            class="text-gray-400 hover:text-gray-600"
            onclick="closeCartModal()"
          >
            <i class="fas fa-times text-xl"></i>
          </button>
        </div>

        <!-- Cuerpo del Modal - Lista de Productos -->
        <div id="cart-items-container" class="py-4 max-h-80 overflow-y-auto">
          <!-- Los productos del carrito se renderizarán aquí dinámicamente -->
          <p class="text-gray-500 text-center" id="empty-cart-message">
            El carrito está vacío.
          </p>
        </div>

        <!-- Pie del Modal - Total y Botones -->
        <div class="pt-4 border-t border-gray-200">
          <div class="flex justify-between items-center mb-4">
            <span class="text-xl font-semibold text-gray-900">Total:</span>
            <span id="cart-total" class="text-2xl font-bold text-pink-600"
              >$0.00</span
            >
          </div>
          <div class="flex flex-col space-y-3">
            <button
              id="modal-buy-whatsapp-button"
              class="w-full bg-green-500 text-white py-3 px-4 rounded-lg font-semibold hover:bg-green-600 transition duration-300 flex items-center justify-center space-x-2 shadow-lg hover:shadow-xl"
            >
              <i class="fab fa-whatsapp"></i>
              <span>Comprar por WhatsApp</span>
            </button>
            <button
              type="button"
              class="w-full bg-gray-200 text-gray-700 py-3 px-4 rounded-lg font-semibold hover:bg-gray-300 transition duration-300"
              onclick="closeCartModal()"
            >
              Seguir Comprando
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Custom Message Modal -->
    <div id="message-modal" class="fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg shadow-xl p-6 w-11/12 max-w-md mx-auto">
            <div class="flex justify-between items-center pb-3 border-b border-gray-200">
                <h3 id="message-modal-title" class="text-xl font-semibold text-gray-900">Mensaje</h3>
                <button type="button" class="text-gray-400 hover:text-gray-600" onclick="closeMessageModal()">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            <div class="py-4">
                <p id="message-modal-content" class="text-gray-700"></p>
            </div>
            <div class="pt-4 border-t border-gray-200 text-right">
                <button type="button" class="bg-pink-600 text-white py-2 px-4 rounded-lg hover:bg-pink-700 transition" onclick="closeMessageModal()">
                    Aceptar
                </button>
            </div>
        </div>
    </div>

    <!-- Enlace a tu archivo JavaScript principal externo -->
    <script>
        // Define el número de WhatsApp globalmente para que main.js pueda acceder a él
        window.whatsappNumber = "{{ whatsapp_number|default:'573007221200' }}";
    </script>
    <script src="{% static 'js/main.js' %}"></script>
    {% block extra_js %}{% endblock %} {# Este es el bloque para JS específico de cada página #}
  </body>
</html>