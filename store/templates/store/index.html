{% load static %}
<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Lumière Glamour</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts: Great Vibes para el logo, Inter para el texto general -->
    <link
      href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Inter:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <!-- Font Awesome para íconos -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
    />
    <style>
      /* Estilo personalizado para la fuente del logo */
      .font-great-vibes {
        font-family: "Great Vibes", cursive;
      }
      /* Estilos para el scrollbar (opcional, para una estética más limpia) */
      ::-webkit-scrollbar {
        width: 8px;
      }
      ::-webkit-scrollbar-track {
        background: #f1f1f1;
        border-radius: 10px;
      }
      ::-webkit-scrollbar-thumb {
        background: #888;
        border-radius: 10px;
      }
      ::-webkit-scrollbar-thumb:hover {
        background: #555;
      }
      /* Ocultar scrollbar pero mantener funcionalidad de scroll */
      #slider::-webkit-scrollbar {
        display: none;
      }
      #slider {
        -ms-overflow-style: none; /* IE and Edge */
        scrollbar-width: none; /* Firefox */
      }

      /* Estilos específicos para el carrusel de anuncios */
      #announcement-carousel-wrapper {
        position: relative;
        width: 100%;
        height: 20rem; /* ajusta si quieres una altura diferente */
        overflow: hidden;
      }
      #announcement-carousel {
        display: flex;
        width: 100%;
        height: 100%;
        transition: transform 0.5s ease-in-out;
      }
      .carousel-item {
        flex: 0 0 100%;
        height: 100%;
        position: relative;
      }
      .carousel-item img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        display: block;
      }
    </style>

    <!-- Google tag (gtag.js) -->
    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=G-RPSFD64V89"
    ></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());

      gtag("config", "G-RPSFD64V89");
    </script>
  </head>

  <body class="bg-gray-100 font-inter text-gray-800">
    <!-- Header Section - Barra de Navegación Unificada -->
    <header class="bg-white shadow-md sticky top-0 z-50">
      <!-- Barra Superior de Información -->
      <div
        class="bg-gradient-to-r from-pink-500 to-purple-600 text-white text-center text-sm py-2 px-4"
      >
        <span>Envíos a toda Colombia 100% seguros y garantizados</span>
      </div>

      <div
        class="container mx-auto px-4 py-3 flex justify-between items-center"
      >
        <!-- Logo de la tienda -->
        <a href="{% url 'home' %}" class="flex items-center space-x-2">
          <img
            src="{% static 'img/logo.png' %}"
            alt="Lumière Glamour Logo"
            class="h-20 w-auto rounded-full shadow-md"
          />
          <span
            class="text-3xl font-great-vibes text-pink-600 hover:text-pink-700 transition duration-300"
          >
            Lumiere Glamour
          </span>
        </a>

        <!-- Barra de Búsqueda (Desktop) -->
        <form
          action="{% url 'home' %}"
          method="get"
          class="hidden md:flex items-center flex-grow max-w-md mx-4"
        >
          <input
            type="text"
            name="q"
            placeholder="Buscar productos..."
            class="w-full px-4 py-2 border border-gray-300 rounded-l-md focus:outline-none focus:ring-2 focus:ring-pink-500"
            value="{{ request.GET.q|default:'' }}"
          />
          <button
            type="submit"
            class="bg-pink-600 text-white px-4 py-2 rounded-r-md hover:bg-pink-700 transition duration-300"
          >
            <i class="fas fa-search"></i>
          </button>
        </form>

        <!-- Iconos de Usuario y Carrito (Desktop) -->
        <div class="hidden md:flex items-center space-x-4">
          <!-- Ícono de usuario comentado temporalmente -->
          <!-- <a href="#" class="text-gray-700 hover:text-pink-600 transition duration-300" title="Mi Cuenta">
                    <i class="fas fa-user text-xl"></i>
                </a> -->
          <a
            href="#"
            class="relative text-gray-700 hover:text-pink-600 transition duration-300"
            title="Mi Carrito"
            onclick="openCartModal()"
          >
            <i class="fas fa-shopping-bag text-xl"></i>
            <span
              id="cart-count"
              class="absolute -top-2 -right-2 bg-pink-600 text-white text-xs font-bold rounded-full h-5 w-5 flex items-center justify-center hidden"
              >0</span
            >
          </a>
        </div>

        <!-- Botón del Menú Móvil (Hamburger) -->
        <button
          id="mobile-menu-button"
          class="md:hidden text-gray-700 hover:text-pink-600 focus:outline-none"
        >
          <svg
            class="w-6 h-6"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M4 6h16M4 12h16M4 18h16"
            ></path>
          </svg>
        </button>
      </div>

      <!-- Menú de Navegación Principal (Desktop) -->
      <nav class="hidden md:flex justify-center py-2 bg-gray-50 shadow-inner">
        <ul class="flex space-x-8">
          <li>
            <a
              href="{% url 'home' %}"
              class="text-gray-700 hover:text-pink-600 font-medium transition duration-300"
              >Inicio</a
            >
          </li>

          <li class="relative group">
            <button
              class="flex items-center text-gray-700 hover:text-pink-600 font-medium transition duration-300 focus:outline-none"
            >
              Categorías
              <svg
                class="ml-1 w-4 h-4"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M19 9l-7 7-7-7"
                ></path>
              </svg>
            </button>
            <div
              class="absolute left-0 mt-2 w-64 bg-white rounded-md shadow-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-300 transform scale-95 group-hover:scale-100 origin-top"
            >
              <div class="py-1">
                {% for categoria in categorias %} {% if
                categoria.subcategorias.all %}
                <div class="relative group/sub">
                  <a
                    href="{% url 'home' %}?categoria={{ categoria.id }}"
                    class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 hover:text-pink-600 flex justify-between items-center"
                  >
                    {{ categoria.nombre }}
                    <svg
                      class="w-4 h-4 transform rotate-90 group-hover/sub:rotate-0 transition-transform duration-200"
                      fill="none"
                      stroke="currentColor"
                      viewBox="0 0 24 24"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M9 5l7 7-7 7"
                      ></path>
                    </svg>
                  </a>
                  <div
                    class="absolute left-full top-0 ml-1 w-48 bg-white rounded-md shadow-lg opacity-0 invisible group-hover/sub:opacity-100 group-hover/sub:visible transition-all duration-300 transform scale-95 group-hover/sub:scale-100 origin-top-left"
                  >
                    {% for sub in categoria.subcategorias.all %}
                    <a
                      href="{% url 'home' %}?subcategoria={{ sub.id }}"
                      class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 hover:text-pink-600"
                    >
                      {{ sub.nombre }}
                    </a>
                    {% endfor %}
                  </div>
                </div>
                {% else %}
                <a
                  href="{% url 'home' %}?categoria={{ categoria.id }}"
                  class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 hover:text-pink-600"
                >
                  {{ categoria.nombre }}
                </a>
                {% endif %} {% endfor %}
              </div>
            </div>
          </li>
          <!-- Elementos de menú configurables desde el admin (MenuItem) -->
          {% if menu_items %} {% for item in menu_items %}
          <li>
            <a
              href="{{ item.url }}"
              class="text-gray-700 hover:text-pink-600 font-medium transition duration-300"
              >{{ item.nombre }}</a
            >
          </li>
          {% endfor %} {% else %}
          <!-- Ejemplos de enlaces si no se configuran desde el admin -->
          <li>
            <a
              href="{% url 'home' %}?ofertas=true"
              class="text-gray-700 hover:text-pink-600 font-medium transition duration-300"
              >Ofertas</a
            >
          </li>
          <li>
            <a
              href="#"
              class="text-gray-700 hover:text-pink-600 font-medium transition duration-300"
              >Contacto</a
            >
          </li>
          <li>
            <a
              href="#"
              class="text-gray-700 hover:text-pink-600 font-medium transition duration-300"
              >Cibermake</a
            >
          </li>
          <li>
            <a
              href="#"
              class="text-gray-700 hover:text-pink-600 font-medium transition duration-300"
              >Blog</a
            >
          </li>
          {% endif %}
        </ul>
      </nav>

      <!-- Menú Móvil (Oculto por defecto) -->
      <div id="mobile-menu" class="hidden md:hidden bg-white shadow-lg pb-4">
        <!-- Barra de Búsqueda (Móvil) -->
        <form action="{% url 'home' %}" method="get" class="px-4 py-2">
          <div class="flex">
            <input
              type="text"
              name="q"
              placeholder="Buscar productos..."
              class="w-full px-4 py-2 border border-gray-300 rounded-l-md focus:outline-none focus:ring-2 focus:ring-pink-500"
              value="{{ request.GET.q|default:'' }}"
            />
            <button
              type="submit"
              class="bg-pink-600 text-white px-4 py-2 rounded-r-md hover:bg-pink-700 transition duration-300"
            >
              <i class="fas fa-search"></i>
            </button>
          </div>
        </form>

        <a
          href="{% url 'home' %}"
          class="block px-4 py-2 text-gray-700 hover:bg-gray-100 hover:text-pink-600"
          >Inicio</a
        >

        <!-- Categorías Desplegables Móviles -->
        <div class="relative">
          <button
            id="mobile-categories-button"
            class="w-full text-left px-4 py-2 text-gray-700 hover:bg-gray-100 hover:text-pink-600 flex justify-between items-center"
          >
            Categorías
            <svg
              class="ml-1 w-4 h-4 transform rotate-0 transition-transform duration-200"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M19 9l-7 7-7-7"
              ></path>
            </svg>
          </button>
          <div
            id="mobile-categories-dropdown"
            class="hidden pl-8 py-1 bg-gray-50"
          >
            <!-- Bucle para Categorías en Móvil -->
            {% for categoria in categorias %}
            <div class="relative">
              <button
                class="w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 hover:text-pink-600 flex justify-between items-center"
                onclick="toggleSubmenu(this)"
              >
                {{ categoria.nombre }} {% if categoria.subcategorias.all %}
                <svg
                  class="w-4 h-4 transform rotate-90 transition-transform duration-200"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M9 5l7 7-7 7"
                  ></path>
                </svg>
                {% endif %}
              </button>
              {% if categoria.subcategorias.all %}
              <div class="hidden pl-4 py-1 bg-gray-100">
                {% for subcategoria in categoria.subcategorias.all %}
                <a
                  href="{% url 'home' %}?subcategoria={{ subcategoria.id }}"
                  class="block px-4 py-2 text-xs text-gray-700 hover:bg-gray-200 hover:text-pink-600"
                  >{{ subcategoria.nombre }}</a
                >
                {% endfor %}
              </div>
              {% endif %}
            </div>
            {% empty %}
            <a href="#" class="block px-4 py-2 text-sm text-gray-500"
              >No hay categorías disponibles.</a
            >
            {% endfor %}
          </div>
        </div>
        <!-- Elementos de menú configurables para móvil -->
        {% if menu_items %} {% for item in menu_items %}
        <a
          href="{{ item.url }}"
          class="block px-4 py-2 text-gray-700 hover:bg-gray-100 hover:text-pink-600"
          >{{ item.nombre }}</a
        >
        {% endfor %} {% else %}
        <a
          href="{% url 'home' %}?ofertas=true"
          class="block px-4 py-2 text-gray-700 hover:bg-gray-100 hover:text-pink-600"
          >Ofertas</a
        >
        <a
          href="#"
          class="block px-4 py-2 text-gray-700 hover:bg-gray-100 hover:text-pink-600"
          >Contacto</a
        >
        <a
          href="#"
          class="block px-4 py-2 text-gray-700 hover:bg-gray-100 hover:text-pink-600"
          >Cibermake</a
        >
        <a
          href="#"
          class="block px-4 py-2 text-gray-700 hover:bg-gray-100 hover:text-pink-600"
          >Blog</a
        >
        {% endif %}
        <!-- Iconos de Usuario y Carrito (Móvil) -->
        <div class="px-4 py-2 flex space-x-4 border-t border-gray-200 mt-2">
          <!-- Ícono de usuario comentado temporalmente -->
          <!-- <a href="#" class="text-gray-700 hover:text-pink-600 transition duration-300" title="Mi Cuenta">
        <i class="fas fa-user text-xl"></i> Mi Cuenta
    </a> -->
          <a
            href="#"
            class="relative text-gray-700 hover:text-pink-600 transition duration-300"
            title="Mi Carrito"
            onclick="openCartModal()"
          >
            <i class="fas fa-shopping-bag text-xl"></i>
            <span
              id="mobile-cart-count"
              class="absolute -top-2 -right-2 bg-pink-600 text-white text-xs font-bold rounded-full h-5 w-5 flex items-center justify-center hidden"
              >0</span
            >
          </a>
        </div>
      </div>
    </header>

    <!-- NUEVA SECCIÓN: Carrusel de Anuncios -->
    {# Solo muestra el carrusel si hay anuncios activos #} {% if anuncios %}
    <section
      class="relative w-full max-w-5xl mx-auto mt-0 rounded-lg shadow-lg overflow-hidden"
    >
      <div id="announcement-carousel-wrapper">
        {# Eliminado flex justify-center items-center #}
        <div id="announcement-carousel">
          {% for anuncio in anuncios %}
          <div class="carousel-item">
            {% if anuncio.url %}
            <a
              href="{{ anuncio.url }}"
              target="_blank"
              class="block w-full h-full"
            >
              {% endif %} {% if anuncio.imagen %}
              <img
                src="{{ anuncio.imagen.url }}"
                alt="{{ anuncio.titulo }}"
                onerror="this.onerror=null;this.src='https://placehold.co/1000x400/cccccc/333333?text=Anuncio';"
              />
              {% else %} {# Imagen de placeholder si no hay imagen #}
              <img
                src="https://placehold.co/1000x400/cccccc/333333?text=Anuncio"
                alt="Placeholder Anuncio"
              />
              {% endif %} {% if anuncio.url %}
            </a>
            {% endif %}
          </div>
          {% endfor %}
        </div>
      </div>

      <!-- Botones de Navegación del Carrusel -->
      <!-- Botón Anterior -->
      <button
        id="prev-announcement"
        class="absolute left-2 sm:left-4 top-1/2 transform -translate-y-1/2 bg-white bg-opacity-50 text-gray-800 p-2 sm:p-3 rounded-full shadow-md hover:bg-opacity-80 transition z-20"
      >
        <i class="fas fa-chevron-left text-base sm:text-xl"></i>
      </button>

      <!-- Botón Siguiente -->
      <button
        id="next-announcement"
        class="absolute right-2 sm:right-4 top-1/2 transform -translate-y-1/2 bg-white bg-opacity-50 text-gray-800 p-2 sm:p-3 rounded-full shadow-md hover:bg-opacity-80 transition z-20"
      >
        <i class="fas fa-chevron-right text-base sm:text-xl"></i>
      </button>

      <!-- Indicadores de Puntos del Carrusel -->
      <div
        id="carousel-indicators"
        class="absolute bottom-4 left-1/2 transform -translate-x-1/2 flex space-x-2 z-20"
      >
        {% for anuncio in anuncios %} {# forloop.counter0 es el índice basado en
        0 #}
        <div
          class="indicator w-3 h-3 bg-white rounded-full cursor-pointer opacity-50 hover:opacity-100 transition"
          data-slide-to="{{ forloop.counter0 }}"
        ></div>
        {% endfor %}
      </div>
    </section>
    {% endif %}

    <!-- Sección de Productos (MOVIDA ARRIBA) -->
    <main class="container mx-auto px-4 py-8">
      <h2 class="text-3xl font-semibold text-center text-gray-900 mb-8">
        {% if query %} Resultados para "{{ query }}" {% if categoria_actual %}
        en {{ nombre_categoria_actual }} {% endif %} {% elif ofertas_activas %}
        {# Nuevo: Título para ofertas #} Ofertas Especiales {% elif
        categoria_actual %} {{ nombre_categoria_actual }} {% else %} Nuestros
        Productos {% endif %}
      </h2>

      <div class="relative">
        <!-- Botones de navegación -->
        <button
          id="slideLeft"
          class="absolute left-0 top-1/2 transform -translate-y-1/2 z-10 bg-white shadow-md rounded-full p-2 hover:bg-pink-500 hover:text-white transition"
        >
          <i class="fas fa-chevron-left"></i>
        </button>
        <button
          id="slideRight"
          class="absolute right-0 top-1/2 transform -translate-y-1/2 z-10 bg-white shadow-md rounded-full p-2 hover:bg-pink-500 hover:text-white transition"
        >
          <i class="fas fa-chevron-right"></i>
        </button>

        <!-- Contenedor deslizable -->
        <div
          id="slider"
          class="overflow-x-auto scroll-smooth whitespace-nowrap space-x-4 pb-4 px-2"
        >
          <div class="inline-flex space-x-4">
            {% for producto in productos %}
            <div
              class="w-64 bg-white rounded-lg shadow-md overflow-hidden transform transition duration-300 hover:scale-105 hover:shadow-xl inline-block align-top relative"
            >
              <!-- Distintivo de OFERTA -->
              {% if producto.descuento > 0 %}
              <div
                class="absolute top-2 right-2 bg-red-500 text-white text-xs font-bold px-2 py-1 rounded-full z-10 shadow-md"
              >
                OFERTA
              </div>
              {% endif %}
              <!-- Enlace a la página de detalle del producto -->
              <a href="{% url 'producto_detalle' producto.id %}">
                {# AQUI CAMBIAMOS PARA IR A LA PAGINA DE DETALLE #} {% if
                producto.imagen %}
                <img
                  src="{{ producto.imagen.url }}"
                  alt="{{ producto.nombre }}"
                  class="w-full h-48 object-cover"
                />
                {% else %}
                <img
                  src="{% static 'img/sin_imagen.jpg' %}"
                  alt="Sin imagen"
                  class="w-full h-48 object-cover"
                />
                {% endif %}
              </a>
              <div class="p-5">
                <h3 class="text-xl font-semibold text-gray-900 mb-2">
                  {{ producto.nombre }}
                </h3>
                <p class="text-gray-600 text-sm mb-3">
                  {{ producto.descripcion|default_if_none:""|truncatechars:100
                  }}
                </p>
                <div class="flex justify-between items-center mb-4">
                  <span class="text-2xl font-bold text-pink-600"
                    >${{ producto.get_precio_final|floatformat:0 }}</span
                  >
                  {% if producto.descuento > 0 %}
                  <span class="text-sm text-gray-500 line-through"
                    >${{ producto.precio|floatformat:0 }}</span
                  >
                  {% endif %}
                </div>
                <!-- Botón "Agregar al Carrito" -->
                <button
                  class="add-to-cart-button w-full bg-pink-600 text-white py-3 px-4 rounded-lg font-semibold hover:bg-pink-700 transition duration-300 flex items-center justify-center space-x-2 shadow-lg hover:shadow-xl"
                  data-product-id="{{ producto.id }}"
                  data-product-name="{{ producto.nombre }}"
                  data-product-price="{{ producto.get_precio_final|floatformat:0 }}"
                >
                  <i class="fas fa-cart-plus"></i>
                  <span>Agregar al Carrito</span>
                </button>
              </div>
            </div>
            {% empty %}
            <!-- Mensaje si no hay productos -->
            <div
              class="col-span-full text-center text-gray-600 p-8 bg-white rounded-lg shadow-md w-full"
            >
              {% if query %}
              <p class="text-xl font-semibold mb-2">
                No encontramos resultados para "<span class="text-pink-600"
                  >{{ query }}</span
                >".
              </p>
              <p class="text-gray-500">
                Intenta buscar con otras palabras clave o revisa nuestras
                categorías.
              </p>
              {% elif ofertas_activas %} {# Nuevo: Mensaje para ofertas vacías
              #}
              <p class="text-xl font-semibold mb-2">
                No hay productos en oferta en este momento.
              </p>
              <p class="text-gray-500">
                ¡Vuelve pronto para ver nuestras promociones!
              </p>
              {% else %}
              <p class="text-xl font-semibold mb-2">
                No hay productos disponibles en esta categoría.
              </p>
              <p class="text-gray-500">
                ¡Pronto tendremos más novedades para ti!
              </p>
              {% endif %}
            </div>
            {% endfor %}
          </div>
        </div>
      </div>
    </main>

    <!-- Sección de Beneficios (MOVIDA ABAJO) -->
    <section
      class="container mx-auto px-4 py-8 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-6 text-center"
    >
      <div
        class="beneficio bg-white p-6 rounded-lg shadow-md flex flex-col items-center justify-center transform transition duration-300 hover:scale-105"
      >
        <i class="fas fa-shield-alt text-4xl text-pink-600 mb-3"></i>
        <p class="font-semibold text-lg">Compra Segura</p>
      </div>
      <div
        class="beneficio bg-white p-6 rounded-lg shadow-md flex flex-col items-center justify-center transform transition duration-300 hover:scale-105"
      >
        <i class="fas fa-paper-plane text-4xl text-pink-600 mb-3"></i>
        <p class="font-semibold text-lg">Envíos a Toda Colombia</p>
      </div>
      <div
        class="beneficio bg-white p-6 rounded-lg shadow-md flex flex-col items-center justify-center transform transition duration-300 hover:scale-105"
      >
        <i class="fas fa-box text-4xl text-pink-600 mb-3"></i>
        <p class="font-semibold text-lg">Distribuidores de Maquillaje</p>
      </div>
      <div
        class="beneficio bg-white p-6 rounded-lg shadow-md flex flex-col items-center justify-center transform transition duration-300 hover:scale-105"
      >
        <i class="fas fa-magic text-4xl text-pink-600 mb-3"></i>
        <p class="font-semibold text-lg">Maquillaje Profesional</p>
      </div>
      <div
        class="beneficio bg-white p-6 rounded-lg shadow-md flex flex-col items-center justify-center transform transition duration-300 hover:scale-105"
      >
        <i class="fas fa-award text-4xl text-pink-600 mb-3"></i>
        <p class="font-semibold text-lg">Calidad Garantizada</p>
      </div>
    </section>

    <!-- Footer Section -->
    <footer class="bg-gray-800 text-white py-8 mt-8">
      <div class="container mx-auto px-4 grid grid-cols-1 md:grid-cols-3 gap-8">
        <div class="footer-col text-center md:text-left">
          <h4 class="text-xl font-semibold mb-4">Lumiere Glamour</h4>
          <p class="text-gray-300">
            Tienda de maquillaje profesional, cuidado facial y accesorios.
          </p>
          <p class="text-gray-300 mt-2">
            <strong>Ipiales - Nariño - Colombia</strong>
          </p>
        </div>
        <div class="footer-col text-center md:text-left">
          <h4 class="text-xl font-semibold mb-4">Enlaces Rápidos</h4>
          <ul>
            <li class="mb-2">
              <a
                href="#"
                class="text-gray-300 hover:text-pink-500 transition duration-300"
                >Brochas</a
              >
            </li>
            <li class="mb-2">
              <a
                href="#"
                class="text-gray-300 hover:text-pink-500 transition duration-300"
                >Bases</a
              >
            </li>
            <li class="mb-2">
              <a
                href="#"
                class="text-gray-300 hover:text-pink-500 transition duration-300"
                >Cuidado Facial</a
              >
            </li>
            <li class="mb-2">
              <a
                href="#"
                class="text-gray-300 hover:text-pink-500 transition duration-300"
                >Descuentos</a
              >
            </li>
          </ul>
        </div>
        <div class="footer-col text-center md:text-left">
          <h4 class="text-xl font-semibold mb-4">Contáctanos</h4>
          <div class="space-y-2">
            <a
              href="https://wa.me/573007221200"
              target="_blank"
              class="text-gray-300 hover:text-pink-500 transition duration-300 flex items-center justify-center md:justify-start"
              title="Enviar mensaje por WhatsApp"
            >
              <i class="fab fa-whatsapp mr-2"></i> WhatsApp
            </a>

            <a
              href="https://www.instagram.com/lumiere_glamour_"
              target="_blank"
              class="text-gray-300 hover:text-pink-500 transition duration-300 flex items-center justify-center md:justify-start"
              title="Visitar Instagram"
            >
              <i class="fab fa-instagram mr-2"></i> Instagram
            </a>

            <a
              href="https://www.facebook.com/share/16uFunJpCr/?mibextid=wwXIfr"
              target="_blank"
              class="text-gray-300 hover:text-pink-500 transition duration-300 flex items-center justify-center md:justify-start"
              title="Ir a nuestra página de Facebook"
            >
              <i class="fab fa-facebook mr-2"></i> Facebook
            </a>

            <a
              href="https://www.tiktok.com/@lumiere.glamour3"
              target="_blank"
              class="text-gray-300 hover:text-pink-500 transition duration-300 flex items-center justify-center md:justify-start"
              title="Ver en TikTok"
            >
              <i class="fab fa-tiktok mr-2"></i> TikTok
            </a>
          </div>
        </div>
      </div>
      <p class="copyright text-center text-gray-400 text-sm mt-8">
        © {{ "now"|date:"Y" }} Lumiere Glamour. Todos los derechos reservados.
      </p>
    </footer>

    <!-- BOTÓN FLOTANTE WHATSAPP (General) -->
    <a
      href="https://wa.me/{{ whatsapp_number|default:'573007221200' }}?text=Hola%2C%20tengo%20una%20consulta%20general."
      class="whatsapp-flotante fixed bottom-6 right-6 bg-green-500 text-white p-4 rounded-full shadow-lg hover:bg-green-600 transition duration-300 z-40"
      target="_blank"
      title="Escríbenos por WhatsApp (Consulta General)"
    >
      <i class="fab fa-whatsapp text-2xl"></i>
    </a>

    <!-- NUEVO BOTÓN FLOTANTE "Comprar por WhatsApp" (para el carrito) -->
    <button
      id="buy-whatsapp-button"
      class="fixed bottom-20 right-6 bg-purple-600 text-white py-3 px-4 rounded-full shadow-lg hover:bg-purple-700 transition duration-300 z-40 flex items-center space-x-2 hidden"
    >
      <i class="fab fa-whatsapp text-xl"></i>
      <span>Comprar Carrito</span>
      <span
        id="buy-whatsapp-cart-count"
        class="bg-white text-purple-600 text-xs font-bold rounded-full h-5 w-5 flex items-center justify-center"
        >0</span
      >
    </button>

    <!-- MODAL DEL CARRITO -->
    <div
      id="cart-modal"
      class="fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center z-50 hidden"
    >
      <div
        class="bg-white rounded-lg shadow-xl p-6 w-11/12 max-w-md mx-auto transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full"
      >
        <!-- Encabezado del Modal -->
        <div
          class="flex justify-between items-center pb-3 border-b border-gray-200"
        >
          <h3 class="text-2xl font-semibold text-gray-900">Tu Carrito</h3>
          <button
            type="button"
            class="text-gray-400 hover:text-gray-600"
            onclick="closeCartModal()"
          >
            <i class="fas fa-times text-xl"></i>
          </button>
        </div>

        <!-- Cuerpo del Modal - Lista de Productos -->
        <div id="cart-items-container" class="py-4 max-h-80 overflow-y-auto">
          <!-- Los productos del carrito se renderizarán aquí dinámicamente -->
          <p class="text-gray-500 text-center" id="empty-cart-message">
            El carrito está vacío.
          </p>
        </div>

        <!-- Pie del Modal - Total y Botones -->
        <div class="pt-4 border-t border-gray-200">
          <div class="flex justify-between items-center mb-4">
            <span class="text-xl font-semibold text-gray-900">Total:</span>
            <span id="cart-total" class="text-2xl font-bold text-pink-600"
              >$0.00</span
            >
          </div>
          <div class="flex flex-col space-y-3">
            <button
              id="modal-buy-whatsapp-button"
              class="w-full bg-green-500 text-white py-3 px-4 rounded-lg font-semibold hover:bg-green-600 transition duration-300 flex items-center justify-center space-x-2 shadow-lg hover:shadow-xl"
            >
              <i class="fab fa-whatsapp"></i>
              <span>Comprar por WhatsApp</span>
            </button>
            <button
              type="button"
              class="w-full bg-gray-200 text-gray-700 py-3 px-4 rounded-lg font-semibold hover:bg-gray-300 transition duration-300"
              onclick="closeCartModal()"
            >
              Seguir Comprando
            </button>
          </div>
        </div>
      </div>
    </div>

    <script>
      // JavaScript para el menú móvil (Hamburger)
      const mobileMenuButton = document.getElementById("mobile-menu-button");
      const mobileMenu = document.getElementById("mobile-menu");
      const mobileCategoriesButton = document.getElementById(
        "mobile-categories-button"
      );
      const mobileCategoriesDropdown = document.getElementById(
        "mobile-categories-dropdown"
      );

      // Toggle del menú principal móvil
      mobileMenuButton.addEventListener("click", () => {
        mobileMenu.classList.toggle("hidden");
        // Cambiar el ícono del botón (hamburger <-> close)
        const icon = mobileMenuButton.querySelector("svg");
        if (mobileMenu.classList.contains("hidden")) {
          icon.innerHTML =
            '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>'; // Ícono de menú
        } else {
          icon.innerHTML =
            '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>'; // Ícono de cerrar
        }
      });

      // Toggle del dropdown de categorías en móvil
      mobileCategoriesButton.addEventListener("click", () => {
        mobileCategoriesDropdown.classList.toggle("hidden");
        // Cambiar la flecha del botón de categorías
        const icon = mobileCategoriesButton.querySelector("svg");
        icon.classList.toggle("rotate-0");
        icon.classList.toggle("rotate-180"); // Gira la flecha
      });

      // Toggle de submenús en móvil (para subcategorías)
      function toggleSubmenu(button) {
        const submenu = button.nextElementSibling; // El div que contiene las subcategorías
        if (submenu) {
          // Asegurarse de que el submenu exista
          submenu.classList.toggle("hidden");
          // Cambiar la flecha del botón del submenú
          const icon = button.querySelector("svg");
          icon.classList.toggle("rotate-90"); // Flecha hacia abajo
          icon.classList.toggle("rotate-0"); // Flecha hacia la derecha
        }
      }

      // --- Lógica del Carrito y WhatsApp ---
      let cart = []; // Array para almacenar los productos en el carrito

      const cartCountSpan = document.getElementById("cart-count");
      const mobileCartCountSpan = document.getElementById("mobile-cart-count");
      const buyWhatsappButton = document.getElementById("buy-whatsapp-button"); // Botón flotante
      const buyWhatsappCartCountSpan = document.getElementById(
        "buy-whatsapp-cart-count"
      ); // Contador botón flotante

      const cartModal = document.getElementById("cart-modal");
      const cartItemsContainer = document.getElementById(
        "cart-items-container"
      );
      const emptyCartMessage = document.getElementById("empty-cart-message");
      const cartTotalSpan = document.getElementById("cart-total");
      const modalBuyWhatsappButton = document.getElementById(
        "modal-buy-whatsapp-button"
      ); // Botón dentro del modal

      // Función para abrir el modal del carrito
      function openCartModal() {
        cartModal.classList.remove("hidden");
        renderCartItems(); // Asegura que los ítems se rendericen al abrir
      }

      // Función para cerrar el modal del carrito
      function closeCartModal() {
        cartModal.classList.add("hidden");
      }

      // Función para actualizar el contador del carrito y la visibilidad del botón de compra
      function updateCartDisplay() {
        const itemCount = cart.length;
        cartCountSpan.textContent = itemCount;
        mobileCartCountSpan.textContent = itemCount;

        if (itemCount > 0) {
          cartCountSpan.classList.remove("hidden");
          mobileCartCountSpan.classList.remove("hidden");
          buyWhatsappButton.classList.remove("hidden");
          buyWhatsappCartCountSpan.textContent = itemCount;
        } else {
          cartCountSpan.classList.add("hidden");
          mobileCartCountSpan.classList.add("hidden");
          buyWhatsappButton.classList.add("hidden");
        }
        renderCartItems(); // Actualiza también el contenido del modal del carrito
      }

      // Función para renderizar los ítems del carrito en el modal
      function renderCartItems() {
        cartItemsContainer.innerHTML = ""; // Limpiar el contenedor actual
        let total = 0;

        if (cart.length === 0) {
          emptyCartMessage.classList.remove("hidden");
        } else {
          emptyCartMessage.classList.add("hidden");
          cart.forEach((item, index) => {
            const itemDiv = document.createElement("div");
            itemDiv.classList.add(
              "flex",
              "justify-between",
              "items-center",
              "py-2",
              "border-b",
              "border-gray-100"
            );
            itemDiv.innerHTML = `
                        <div class="flex-1">
                            <p class="text-gray-800 font-medium">${
                              item.name
                            }</p>
                            <p class="text-gray-600 text-sm">$${parseFloat(
                              item.price
                            ).toFixed(2)}</p>
                        </div>
                        <button class="text-red-500 hover:text-red-700 ml-4" onclick="removeItemFromCart('${
                          item.id
                        }')">
                            <i class="fas fa-trash-alt"></i>
                        </button>
                    `;
            cartItemsContainer.appendChild(itemDiv);
            total += parseFloat(item.price);
          });
        }
        cartTotalSpan.textContent = `$${total.toFixed(2)}`;
      }

      // Función para eliminar un ítem del carrito
      function removeItemFromCart(productIdToRemove) {
        // Encuentra el índice del primer producto con el ID coincidente
        const indexToRemove = cart.findIndex(
          (item) => item.id === productIdToRemove
        );
        if (indexToRemove > -1) {
          cart.splice(indexToRemove, 1); // Elimina solo un elemento
          console.log("Producto eliminado del carrito."); // Reemplazado alert con console.log
          updateCartDisplay(); // Actualiza la visualización del carrito
        }
      }

      // Añadir producto al carrito (listener para botones en tarjetas)
      document.querySelectorAll(".add-to-cart-button").forEach((button) => {
        button.addEventListener("click", (event) => {
          const productId = event.currentTarget.dataset.productId;
          const productName = event.currentTarget.dataset.productName;
          const productPrice = event.currentTarget.dataset.productPrice;

          cart.push({ id: productId, name: productName, price: productPrice });

          console.log(`"${productName}" ha sido agregado al carrito.`); // Reemplazado alert con console.log

          updateCartDisplay(); // Actualiza el contador del carrito
        });
      });

      // Funcionalidad del botón "Comprar por WhatsApp" (para el carrito)
      function sendCartToWhatsApp() {
        if (cart.length === 0) {
          console.log(
            "Tu carrito está vacío. Agrega productos antes de comprar."
          ); // Reemplazado alert con console.log
          return;
        }

        const whatsappNumber = '{{ whatsapp_number|default:"573007221200" }}'; // Usa el valor de Django o un default
        let message =
          "¡Hola! Me gustaría comprar los siguientes productos de mi carrito:\n\n";
        let total = 0;

        cart.forEach((item, index) => {
          message += `${index + 1}. ${item.name} - $${item.price}\n`;
          total += parseFloat(item.price);
        });

        message += `\nTotal estimado: $${total.toFixed(2)}\n`;
        message +=
          "Por favor, confírmame la disponibilidad y el proceso de pago.";

        const whatsappUrl = `https://wa.me/${whatsappNumber}?text=${encodeURIComponent(
          message
        )}`;
        window.open(whatsappUrl, "_blank");

        // Opcional: Limpiar el carrito después de enviar el pedido
        cart = [];
        updateCartDisplay();
        console.log(
          "Tu pedido ha sido enviado a WhatsApp. Revisa tu chat para continuar la compra."
        ); // Reemplazado alert con console.log
        closeCartModal(); // Cierra el modal después de enviar
      }

      // Asignar la función a los botones de WhatsApp
      buyWhatsappButton.addEventListener("click", sendCartToWhatsApp); // Botón flotante
      modalBuyWhatsappButton.addEventListener("click", sendCartToWhatsApp); // Botón dentro del modal

      // Slider horizontal de productos
      const slider = document.getElementById("slider");
      const slideLeft = document.getElementById("slideLeft");
      const slideRight = document.getElementById("slideRight");

      if (slider) {
        // Asegurarse de que el slider exista
        slideLeft.addEventListener("click", () => {
          slider.scrollLeft -= 300; // Desplaza 300px a la izquierda
        });
        slideRight.addEventListener("click", () => {
          slider.scrollLeft += 300; // Desplaza 300px a la derecha
        });
      }

      // Lógica del Carrusel de Anuncios (Mejorada)
      document.addEventListener("DOMContentLoaded", function () {
        const carouselWrapper = document.getElementById(
          "announcement-carousel-wrapper"
        );
        const carousel = document.getElementById("announcement-carousel");
        const items = carousel
          ? carousel.querySelectorAll(".carousel-item")
          : [];
        const prevBtn = document.getElementById("prev-announcement");
        const nextBtn = document.getElementById("next-announcement");
        const indicatorsContainer = document.getElementById(
          "carousel-indicators"
        );
        const indicators = indicatorsContainer
          ? indicatorsContainer.querySelectorAll(".indicator")
          : [];

        let currentIndex = 0;
        let totalSlides = items.length;
        let autoSlideInterval;
        let dragThreshold = 50; // Píxeles para considerar un swipe

        function updateCarousel() {
          if (!carousel || totalSlides === 0) return;

          const offset = -currentIndex * 100;
          carousel.style.transform = `translateX(${offset}%)`;

          // Actualizar indicadores de puntos
          indicators.forEach((dot, i) => {
            dot.classList.toggle("opacity-100", i === currentIndex);
            dot.classList.toggle("opacity-50", i !== currentIndex);
          });
        }

        function goToSlide(index) {
          // Asegura que el índice esté dentro de los límites y envuelve si es necesario
          currentIndex = (index + totalSlides) % totalSlides;
          updateCarousel();
        }

        function startAutoSlide() {
          stopAutoSlide(); // Limpia cualquier intervalo existente
          if (totalSlides > 1) {
            // Solo auto-desliza si hay más de una diapositiva
            autoSlideInterval = setInterval(() => {
              goToSlide(currentIndex + 1); // goToSlide maneja el módulo
            }, 5000); // Cambia de slide cada 5 segundos
          }
        }

        function stopAutoSlide() {
          clearInterval(autoSlideInterval);
        }

        // Event listeners para los botones de navegación del carrusel
        if (prevBtn) {
          prevBtn.addEventListener("click", () => {
            stopAutoSlide(); // Detener auto-slide al interactuar manualmente
            goToSlide(currentIndex - 1);
            startAutoSlide(); // Reiniciar auto-slide después de la interacción
          });
        }

        if (nextBtn) {
          nextBtn.addEventListener("click", () => {
            stopAutoSlide(); // Detener auto-slide al interactuar manualmente
            goToSlide(currentIndex + 1);
            startAutoSlide(); // Reiniciar auto-slide después de la interacción
          });
        }

        // Event listeners para los indicadores de puntos
        if (indicatorsContainer) {
          indicators.forEach((dot, i) => {
            dot.addEventListener("click", () => {
              stopAutoSlide(); // Detener auto-slide al interactuar manualmente
              goToSlide(i);
              startAutoSlide(); // Reiniciar auto-slide después de la interacción
            });
          });
        }

        // Swipe móvil
        let startX = 0;
        let isDragging = false;

        if (carouselWrapper) {
          // Asegurarse de que el carouselWrapper exista para los eventos táctiles
          carouselWrapper.addEventListener("touchstart", (e) => {
            startX = e.touches[0].clientX;
            isDragging = true;
            stopAutoSlide(); // Detener auto-slide cuando el usuario comienza a interactuar
          });

          carouselWrapper.addEventListener("touchmove", (e) => {
            if (!isDragging) return;
            const currentX = e.touches[0].clientX;
            const diffX = currentX - startX;

            // Solo activar el deslizamiento una vez por gesto de swipe
            if (Math.abs(diffX) > dragThreshold) {
              if (diffX < 0) {
                // Deslizado hacia la izquierda
                goToSlide(currentIndex + 1);
              } else {
                // Deslizado hacia la derecha
                goToSlide(currentIndex - 1);
              }
              isDragging = false; // Evita múltiples deslizamientos de un solo arrastre largo
              startX = currentX; // Reinicia startX para evitar que se vuelva a activar inmediatamente si se sigue arrastrando
            }
          });

          carouselWrapper.addEventListener("touchend", () => {
            isDragging = false;
            startAutoSlide(); // Reanudar auto-slide después de la interacción
          });

          // Añadir touchcancel para mayor robustez (por si el toque se interrumpe)
          carouselWrapper.addEventListener("touchcancel", () => {
            isDragging = false;
            startAutoSlide();
          });
        }

        // Configuración inicial al cargar la página y en cada redimensionamiento
        const resizeObserver = new ResizeObserver(() => {
          if (carouselWrapper && carousel) {
            updateCarousel(); // Recalcular posición y ancho en cada redimensionamiento
          }
        });
        resizeObserver.observe(carouselWrapper); // Observa el contenedor principal para cambios de tamaño

        // Llamada inicial para establecer el carrusel
        if (carousel && items.length > 0) {
          updateCarousel(); // Mostrar la primera diapositiva y activar el primer indicador
          startAutoSlide(); // Iniciar el auto-deslizamiento
        }
      }); // Fin de DOMContentLoaded

      // Inicializar la visualización del carrito al cargar la página
      updateCartDisplay();
    </script>
  </body>
</html>
