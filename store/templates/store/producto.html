{% extends 'base.html' %} {# Asegúrate de que esta ruta sea correcta #}
{% load static %}

{% block title %}{{ producto.nombre }} - Lumière Glamour{% endblock %}

{% block content %}
    <!-- Main Content - Product Detail -->
    <main class="container mx-auto px-4 py-8">
        <!-- Breadcrumbs -->
        <nav class="text-sm text-gray-600 mb-6">
            <ol class="list-none p-0 inline-flex">
                <li class="flex items-center">
                    <a href="{% url 'home' %}" class="text-pink-600 hover:underline">Inicio</a>
                    <span class="mx-2">/</span>
                </li>
                {% if producto.categoria %}
                    <li class="flex items-center">
                        <a href="{% url 'categoria' producto.categoria.slug %}" class="text-pink-600 hover:underline">{{ producto.categoria.nombre }}</a>
                        <span class="mx-2">/</span>
                    </li>
                {% endif %}
                {# Eliminada la referencia a subcategoria ya que el modelo Producto ahora solo tiene una Categoria #}
                <li class="text-gray-800 font-semibold">{{ producto.nombre }}</li>
            </ol>
        </nav>

        <div class="bg-white rounded-lg shadow-xl p-6 flex flex-col md:flex-row gap-8">
            <!-- Product Image Section -->
            <div class="md:w-1/2 flex flex-col items-center">
                <div class="w-full max-w-md h-96 flex items-center justify-center overflow-hidden rounded-lg shadow-md mb-4">
                    {% if producto.imagen %}
                        <img src="{{ producto.imagen.url }}" alt="{{ producto.nombre }}" class="max-w-full max-h-full object-contain" id="main-product-image">
                    {% else %}
                        <img src="{% static 'img/sin_imagen.jpg' %}" alt="Sin imagen" class="max-w-full max-h-full object-contain" id="main-product-image">
                    {% endif %}
                </div>
                <!-- Thumbnail Images -->
                <div class="flex space-x-2 mt-2">
                    {# Muestra la imagen principal como miniatura #}
                    {% if producto.imagen %}
                        <img src="{{ producto.imagen.url }}" alt="{{ producto.nombre }} principal" class="w-16 h-16 object-cover rounded-md border border-gray-300 cursor-pointer hover:border-pink-500 transition" onclick="changeMainImage('{{ producto.imagen.url }}')">
                    {% endif %}
                    {# Itera sobre las imágenes adicionales del producto #}
                    {% for img in producto.images.all %}
                        <img src="{{ img.image.url }}" alt="{{ img.alt_text|default:producto.nombre }}" class="w-16 h-16 object-cover rounded-md border border-gray-300 cursor-pointer hover:border-pink-500 transition" onclick="changeMainImage('{{ img.image.url }}')">
                    {% endfor %}
                </div>
            </div>

            <!-- Product Details Section -->
            <div class="md:w-1/2 flex flex-col">
                <h1 class="text-4xl font-bold text-gray-900 mb-3">{{ producto.nombre }}</h1>
                <div class="flex items-baseline mb-4">
                    <span class="text-5xl font-extrabold text-pink-600 mr-4">${{ producto.get_precio_final|floatformat:2 }}</span>
                    {% if producto.descuento > 0 %}
                        <span class="text-xl text-gray-500 line-through">${{ producto.precio|floatformat:2 }}</span>
                    {% endif %}
                </div>

                <p class="text-gray-700 mb-6 leading-relaxed">{{ producto.descripcion|default_if_none:"No hay descripción disponible." }}</p>

                <div class="flex items-center space-x-4 mb-8">
                    <label for="quantity" class="text-lg font-medium text-gray-700">Cantidad:</label>
                    <input type="number" id="quantity" value="1" min="1" class="w-20 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-pink-500 text-center">
                </div>

                <!-- Botón Añadir al Carrito - Ahora con clase 'btn-agregar-carrito' -->
                <button class="btn-agregar-carrito w-full bg-pink-600 text-white py-4 px-6 rounded-lg font-semibold text-xl hover:bg-pink-700 transition duration-300 flex items-center justify-center space-x-3 shadow-lg hover:shadow-xl"
                        data-product-id="{{ producto.id }}"
                        data-product-name="{{ producto.nombre }}"
                        data-product-price="{{ producto.get_precio_final|floatformat:2 }}"
                        data-selected-variant-id="{{ producto.id }}" {# Usar ID del producto como ID de variante por defecto #}
                        data-selected-color="N/A"> {# Color por defecto si no hay variantes de color #}
                    <i class="fas fa-cart-plus text-2xl"></i>
                    <span>Añadir al Carrito</span>
                </button>

                <!-- Información adicional (puedes hacerla configurable con SiteSetting si quieres) -->
                <div class="mt-8 border-t border-gray-200 pt-6">
                    <p class="text-gray-700 text-sm mb-2">
                        <i class="fas fa-check-circle text-green-500 mr-2"></i> Producto disponible para envío inmediato.
                    </p>
                    <p class="text-gray-700 text-sm">
                        <i class="fas fa-truck text-blue-500 mr-2"></i> Envío gratis en pedidos superiores a $X.
                    </p>
                </div>
            </div>
        </div>

        <!-- Full Description Section -->
        <div class="bg-white rounded-lg shadow-xl p-6 mt-8">
            <h2 class="text-2xl font-bold text-gray-900 mb-4">Conoce más sobre {{ producto.nombre }}</h2>
            <div class="prose max-w-none text-gray-700 leading-relaxed ck-content">
                {# Muestra la descripción larga si existe, de lo contrario, la descripción corta #}
                {% if producto.long_description %}
                    {{ producto.long_description|safe }} {# Usar 'safe' para renderizar HTML de RichTextField #}
                {% else %}
                    <p>{{ producto.descripcion|default_if_none:"No hay descripción detallada disponible." }}</p>
                {% endif %}
            </div>
        </div>

        <!-- Social Sharing Section -->
        <div class="bg-white rounded-lg shadow-xl p-6 mt-8 text-center">
            <h2 class="text-2xl font-bold text-gray-900 mb-4">Compártelo en:</h2>
            <div class="flex justify-center space-x-6">
                <a href="https://www.facebook.com/sharer/sharer.php?u={{ request.build_absolute_uri }}" target="_blank" class="text-blue-600 hover:text-blue-800 transition transform hover:scale-110" title="Compartir en Facebook">
                    <i class="fab fa-facebook-square text-4xl"></i>
                </a>
                <a href="https://wa.me/?text={{ producto.nombre|urlencode }}%20-%20Mira%20este%20producto%3A%20{{ request.build_absolute_uri|urlencode }}" target="_blank" class="text-green-500 hover:text-green-700 transition transform hover:scale-110" title="Compartir en WhatsApp">
                    <i class="fab fa-whatsapp-square text-4xl"></i>
                </a>
            </div>
        </div>
    </main>
{% endblock %}

{# ELIMINADO: El bloque extra_js ya no es necesario aquí, la lógica se maneja en base.html #}
